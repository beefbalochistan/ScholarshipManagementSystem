@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService AuthorizationService
@using ScholarshipManagementSystem.Constants
@model ScholarshipManagementSystem.Models.ViewModels.ResultUploadTypeViewModel

@{ ViewData["Title"] = "Create";
    ViewBag.pageTitle = "Add";
    ViewBag.Title = "Result Upload";
    ViewBag.pTitle = "Result Upload";

    Layout = "~/Views/_Shared/_Layout.cshtml"; }


@if (true)
{
<div class="checkout-tabs">
    <div class="row">
        <div class="col-lg-2">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">

                <a class="nav-link active" id="v-pills-privacy-tab" data-toggle="pill" href="#v-pills-privacy" role="tab" aria-controls="v-pills-privacy" aria-selected="false">
                    <i class="bx bx-list-plus d-block check-nav-icon mt-4 mb-2"></i>
                    <p class="font-weight-bold mb-4">Add New Result Upload</p>
                </a>
                <a class="nav-link" id="v-pills-support-tab" data-toggle="pill" href="#v-pills-support" role="tab" aria-controls="v-pills-support" aria-selected="false">
                    <i class="bx bx-support d-block check-nav-icon mt-4 mb-2"></i>
                    <p class="font-weight-bold mb-4">Support</p>
                </a>
            </div>
        </div>
        <div class="col-lg-10">
            <div class="card">
                <div class="card-body">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-privacy" role="tabpanel" aria-labelledby="v-pills-privacy-tab">
                            <div class="alert alert-info" style="padding: .40rem 1.25rem" role="alert">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h4 class="mt-2 card-title">Add New Result Upload</h4>
                                    </div>
                                </div>
                            </div>
                            <form asp-controller="GazResultUpload" asp-action="Index" enctype="multipart/form-data" method="post" onsubmit="theButton.disabled = true; return true;">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                            <label asp-for="ResultUploadTypeId" class="control-label"></label>
                                            <select asp-for="ResultUploadTypeId"  id="ResultUploadTypeId" class="form-control" asp-items="Model.ResultUploadType" required>
                                            </select>
                                            <span asp-validation-for="ResultUploadTypeId" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="ExcelFile" class="control-label"></label>
                                            <input asp-for="ExcelFile" class="form-control" id="customFile" accept=".xls,.xlsx" required onchange="loadFileexcel()">
                                            <span asp-validation-for="ExcelFile" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-12" style="clear:both">

                                        <div class="form-group">
                                            <input type="submit" name="theButton" value="Add Result Upload" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <hr />
                            <div id="dvExcel" style="height:400px;overflow:scroll;"></div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-support" role="tabpanel" aria-labelledby="v-pills-support-tab">
                            <h4 class="card-title mb-5">Support</h4>

                            <div class="faq-box media mb-4">
                                <div class="faq-icon mr-3">
                                    <i class="bx bx-help-circle font-size-20 text-success"></i>
                                </div>
                                <div class="media-body">
                                    <h5 class="font-size-15">Where can I get some?</h5>
                                    <p class="text-muted">To an English person, it will seem like simplified English, as a skeptical Cambridge friend of mine told me what Occidental</p>
                                </div>
                            </div>
                            <div class="faq-box media mb-4">
                                <div class="faq-icon mr-3">
                                    <i class="bx bx-help-circle font-size-20 text-success"></i>
                                </div>
                                <div class="media-body">
                                    <h5 class="font-size-15">Where does it come from?</h5>
                                    <p class="text-muted">Everyone realizes why a new common language would be desirable one could refuse to pay expensive translators.</p>
                                </div>
                            </div>

                            <div class="faq-box media mb-4">
                                <div class="faq-icon mr-3">
                                    <i class="bx bx-help-circle font-size-20 text-success"></i>
                                </div>
                                <div class="media-body">
                                    <h5 class="font-size-15">Why do we use it?</h5>
                                    <p class="text-muted">Their separate existence is a myth. For science, music, sport, etc, Europe uses the same vocabulary.</p>
                                </div>
                            </div>
                            <div class="faq-box media mb-4">
                                <div class="faq-icon mr-3">
                                    <i class="bx bx-help-circle font-size-20 text-success"></i>
                                </div>
                                <div class="media-body">
                                    <h5 class="font-size-15">Where can I get some?</h5>
                                    <p class="text-muted">If several languages coalesce, the grammar of the resulting language is more simple and regular than that of the individual languages.</p>
                                </div>
                            </div>

                            <div class="faq-box media">
                                <div class="faq-icon mr-3">
                                    <i class="bx bx-help-circle font-size-20 text-success"></i>
                                </div>
                                <div class="media-body">
                                    <h5 class="font-size-15">What is Lorem Ipsum?</h5>
                                    <p class="text-muted">New common language will be more simple and regular than the existing European languages. It will be as simple as occidental.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> }
else
{
<div class="account-pages my-5 pt-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="text-center mb-5">
                    <h1 class="display-2 font-weight-medium">4<i class="bx bx-buoy bx-spin text-primary display-3"></i>4</h1>
                    <h4 class="text-uppercase">Sorry, page not found</h4>
                    @*<div class="mt-5 text-center">
                            <a class="btn btn-primary waves-effect waves-light" href=@Url.Action("Index", "index")>Back to Dashboard</a>
                        </div>*@
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-8 col-xl-6">
                <div>
                    <img src="~/assets/images/error-img.png" alt="" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</div>}
 <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
 
 
<script>
    function loadFileexcel() {
        try {
            var myloading = '<div id="status"> <div class="spinner-chase"> <div class="chase-dot"></div> <div class="chase-dot"></div> <div class="chase-dot"></div> <div class="chase-dot"></div> <div class="chase-dot"></div> <div class="chase-dot"></div> </div> </div>';

            $("#dvExcel").html(myloading);
            //Reference the FileUpload element.
            var fileUpload = $("#customFile")[0];
            var ddlExcelFile = $('#ResultUploadTypeId').val();
             
            //Validate whether File is valid Excel file.
            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
            if (regex.test(fileUpload.value.toLowerCase())) {
                if (typeof (FileReader) != "undefined") {
                    var reader = new FileReader();

                    //For Browsers other than IE.
                    if (reader.readAsBinaryString) {
                        reader.onload = function (e) {
                            if (ddlExcelFile == "1") {
                                ProcessExcelHSSC(e.target.result);
                            }
                            else if (ddlExcelFile == "2") {
                                ProcessExcelSSC(e.target.result);
                            }
                        };
                        reader.readAsBinaryString(fileUpload.files[0]);
                    } else {
                        //For IE Browser.
                        reader.onload = function (e) {
                            var data = "";
                            var bytes = new Uint8Array(e.target.result);
                            for (var i = 0; i < bytes.byteLength; i++) {
                                data += String.fromCharCode(bytes[i]);
                            }

                            if (ddlExcelFile == "1") {
                                ProcessExcelHSSC(data);
                            }
                            else if (ddlExcelFile == "2") {
                                ProcessExcelSSC(data);
                            }
                        };
                        reader.readAsArrayBuffer(fileUpload.files[0]);
                    }
                } else {
                    toastr.error("This browser does not support HTML5");
                }
            } else {
                toastr.error("Please upload a valid Excel file.");
                $('#dtExcel').DataTable();
            }
        }
        catch (err) {
            toastr.error(err.message); 
        }       
    }
    function ProcessExcelSSC(data) {
        //Read the Excel File data.
        var workbook = XLSX.read(data, {
            type: 'binary'
        });

        //Fetch the name of First Sheet.
        var firstSheet = workbook.SheetNames[0];

        //Read all rows from First Sheet into an JSON array.
        var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);

        //Create a HTML Table element.
        var table = $("<table id='dtExcel' class='table table-bordered dt-responsive nowrap' />");
        // table[0].addclass = "table table-bordered dt-responsive nowrap";

        //Add the header row.
        var row = $(table[0].insertRow(-1));

        //Add the header cells.
        var headerCell = $("<th />");
        headerCell.html("Sr .");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("Roll NO");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("REG NO");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("Name");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Father Name");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Institute");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Institute District");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Group");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Candidate District");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Marks");
        row.append(headerCell); 
        headerCell = $("<th />");
        headerCell.html("Pass_Fail");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Remarks");
        row.append(headerCell);

        //Add the data rows from Excel file.
        for (var i = 0; i < excelRows.length; i++) {
            //Add the data row.
            var row = $(table[0].insertRow(-1));

            //Add the data cells.
            var cell = $("<td />");
            cell.html(i + 1);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].Roll_NO);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].REG_NO);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].Name);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Father_Name);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Institute);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Institute_District);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Candidate_District);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Marks_);
            row.append(cell); 
            cell = $("<td />");
            cell.html(excelRows[i].Pass_Fail);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Remarks);
            row.append(cell);
        }

        var dvExcel = $("#dvExcel");
        dvExcel.html("");
        dvExcel.append(table);
    };

    function ProcessExcelHSSC(data) {
        //Read the Excel File data.
        var workbook = XLSX.read(data, {
            type: 'binary'
        });

        //Fetch the name of First Sheet.
        var firstSheet = workbook.SheetNames[0];

        //Read all rows from First Sheet into an JSON array.
        var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);

        //Create a HTML Table element.
        var table = $("<table id='dtExcel' class='table table-bordered dt-responsive nowrap' />");
        // table[0].addclass = "table table-bordered dt-responsive nowrap";

        //Add the header row.
        var row = $(table[0].insertRow(-1));

        //Add the header cells.
        var headerCell = $("<th />");
        headerCell.html("Sr .");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("Roll NO");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("REG NO");
        row.append(headerCell);

        var headerCell = $("<th />");
        headerCell.html("Name");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Father Name");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Institute");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Institute District");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Group");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Candidate District");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Marks");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Type");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Pass_Fail");
        row.append(headerCell);
        headerCell = $("<th />");
        headerCell.html("Remarks");
        row.append(headerCell);

        //Add the data rows from Excel file.
        for (var i = 0; i < excelRows.length; i++) {
            //Add the data row.
            var row = $(table[0].insertRow(-1));

            //Add the data cells.
            var cell = $("<td />");
            cell.html(i + 1);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].Roll_NO);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].REG_NO);
            row.append(cell);

            cell = $("<td />");
            cell.html(excelRows[i].Name);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Father_Name);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Institute);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Institute_District);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Candidate_District);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Marks_);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Type);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Pass_Fail);
            row.append(cell);
            cell = $("<td />");
            cell.html(excelRows[i].Remarks);
            row.append(cell);
        }

        var dvExcel = $("#dvExcel");
        dvExcel.html("");
        dvExcel.append(table);
    };

</script>
@if (@ViewBag.Message != null)
{

@if (@ViewBag.MessageType == "Success")
{
<script type="text/javascript">
    toastr.success("@ViewBag.Message");
</script>
 }
else
{
<script type="text/javascript">
    toastr.error("@ViewBag.Message");
</script>
}}